<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android中的进程与线程 | Shoewann&#39;s Personal Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="节选来自：Android 官方文档-  Process And Thread 

当某个应用组件启动且该应用没有运行其他任何组件时，Android 系统会使用单个执行线程为应用启动新的 Linux 进程。默认情况下，同一应用的所有组件在相同的进程和线程（称为“主”线程）中运行。 如果某个应用组件启动且该应用已存在进程（因为存在该应用的其他组件），则该组件会在此进程内启动并使用相同的执行线程。 但">
<meta property="og:type" content="article">
<meta property="og:title" content="Android中的进程与线程">
<meta property="og:url" content="https://shoewann0402.github.io/2016/05/15/Android中的进程与线程/index.html">
<meta property="og:site_name" content="Shoewann's Personal Blog">
<meta property="og:description" content="节选来自：Android 官方文档-  Process And Thread 

当某个应用组件启动且该应用没有运行其他任何组件时，Android 系统会使用单个执行线程为应用启动新的 Linux 进程。默认情况下，同一应用的所有组件在相同的进程和线程（称为“主”线程）中运行。 如果某个应用组件启动且该应用已存在进程（因为存在该应用的其他组件），则该组件会在此进程内启动并使用相同的执行线程。 但">
<meta property="og:updated_time" content="2016-05-16T00:20:54.674Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android中的进程与线程">
<meta name="twitter:description" content="节选来自：Android 官方文档-  Process And Thread 

当某个应用组件启动且该应用没有运行其他任何组件时，Android 系统会使用单个执行线程为应用启动新的 Linux 进程。默认情况下，同一应用的所有组件在相同的进程和线程（称为“主”线程）中运行。 如果某个应用组件启动且该应用已存在进程（因为存在该应用的其他组件），则该组件会在此进程内启动并使用相同的执行线程。 但">
  
    <link rel="alternate" href="/atom.xml" title="Shoewann&#39;s Personal Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Shoewann&#39;s Personal Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Love Google Technology , Just Do It !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shoewann0402.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Android中的进程与线程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/15/Android中的进程与线程/" class="article-date">
  <time datetime="2016-05-15T10:47:22.000Z" itemprop="datePublished">2016-05-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android中的进程与线程
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>节选来自：Android 官方文档- <a href="https://developer.android.com/guide/components/processes-and-threads.html" target="_blank" rel="external"> Process And Thread </a></p>
</blockquote>
<p>当某个应用组件启动且该应用没有运行其他任何组件时，<strong>Android</strong> 系统会使用单个执行线程为应用启动新的 <strong>Linux</strong> 进程。默认情况下，同一应用的所有组件在相同的进程和线程（称为<strong>“</strong>主<strong>”</strong>线程）中运行。 如果某个应用组件启动且该应用已存在进程（因为存在该应用的其他组件），则该组件会在此进程内启动并使用相同的执行线程。 但是，您可以安排应用中的其他组件在单独的进程中运行，并为任何进程创建额外的线程。</p>
<p>本文档介绍进程和线程在 <strong>Android</strong> 应用中的工作方式。</p>
<a id="more"></a>
<h2 id="进程（Process）"><a href="#进程（Process）" class="headerlink" title="进程（Process）"></a>进程（Process）</h2><p>默认情况下，同一应用的所有组件均在相同的进程中运行，且大多数应用都不会改变这一点。 但是，如果您发现需要控制某个组件所属的进程，则可在清单文件中执行此操作。</p>
<p>各类组件元素的清单文件条目— <a href="https://developer.android.com/guide/topics/manifest/activity-element.html" target="_blank" rel="external">activity</a> 、<a href="https://developer.android.com/guide/topics/manifest/service-element.html" target="_blank" rel="external">service</a>、<a href="https://developer.android.com/guide/topics/manifest/receiver-element.html" target="_blank" rel="external">receiver</a>和<a href="https://developer.android.com/guide/topics/manifest/provider-element.html" target="_blank" rel="external">provider</a>—均支持<strong>android:process</strong>属性，此属性可以指定该组件应在哪个进程运行。您可以设置此属性，使每个组件均在各自的进程中运行，或者使一些组件共享一个进程，而其他组件则不共享。 此外，您还可以设置 <strong>android:process</strong>，使不同应用的组件在相同的进程中运行，但前提是这些应用共享相同的 <strong>Linux</strong> 用户 <strong>ID</strong> 并使用相同的证书进行签署。</p>
<p>此外，<a href="https://developer.android.com/guide/topics/manifest/application-element.html" target="_blank" rel="external">application</a> 元素还支持 <strong>android:process</strong> 属性，以设置适用于所有组件的默认值。</p>
<p>如果内存不足，而其他为用户提供更紧急服务的进程又需要内存时，<strong>Android</strong> 可能会决定在某一时刻关闭某一进程。在被终止进程中运行的应用组件也会随之销毁。 当这些组件需要再次运行时，系统将为它们重启进程。</p>
<p>决定终止哪个进程时，<strong>Android</strong>系统将权衡它们对用户的相对重要程度。例如，相对于托管可见 <strong>Activity</strong> 的进程而言，它更有可能关闭托管屏幕上不再可见的 <strong>Activity</strong> 进程。 因此，是否终止某个进程的决定取决于该进程中所运行组件的状态。 下面，我们介绍决定终止进程所用的规则。</p>
<h3 id="进程生命周期（Process-Lifecycle）"><a href="#进程生命周期（Process-Lifecycle）" class="headerlink" title="进程生命周期（Process Lifecycle）"></a>进程生命周期（Process Lifecycle）</h3><p><strong>Android</strong> 系统将尽量长时间地保持应用进程，但为了新建进程或运行更重要的进程，最终需要清除旧进程来回收内存。 为了确定保留或终止哪些进程，系统会根据进程中正在运行的组件以及这些组件的状态，将每个进程放入“重要性层次结构”中。 必要时，系统会首先消除重要性最低的进程，然后是重要性略逊的进程，依此类推，以回收系统资源。</p>
<p>重要性层次结构一共有 <strong>5</strong>级。以下列表按照重要程度列出了各类进程（第一个进程最重要，将是最后一个被终止的进程）：</p>
<p>  <strong>1.前台进程</strong><br>      用户当前操作所必需的进程。如果一个进程满足以下任一条件，即视为前台进程：</p>
<blockquote>
<ul>
<li>托管用户正在交互的 <a href="https://developer.android.com/reference/android/app/Activity.html" target="_blank" rel="external">Activity</a>（已调用 <a href="https://developer.android.com/reference/android/app/Activity.html" target="_blank" rel="external">Activity</a> 的 <a href="https://developer.android.com/reference/android/app/Activity.html#onResume(" target="_blank" rel="external">onResume()</a>) 方法）</li>
<li>托管某个 <a href="https://developer.android.com/reference/android/app/Service.html" target="_blank" rel="external">Service</a>，后者绑定到用户正在交互的 <strong>Activity</strong></li>
<li>托管正在“前台”运行的 <a href="https://developer.android.com/reference/android/app/Service.html" target="_blank" rel="external">Service</a>（服务已调用 <a href="https://developer.android.com/reference/android/app/Service.html#startForeground(int, android.app.Notification" target="_blank" rel="external">startForeground()</a>)）</li>
<li>托管正执行一个生命周期回调的 <a href="https://developer.android.com/reference/android/app/Service.html" target="_blank" rel="external">Service</a>（<a href="https://developer.android.com/reference/android/app/Service.html#onCreate(" target="_blank" rel="external">onCreate()</a>)、<a href="https://developer.android.com/reference/android/app/Service.html#onStart(android.content.Intent, int" target="_blank" rel="external">onStart()</a>) 或 <a href="https://developer.android.com/reference/android/app/Service.html#onDestroy(" target="_blank" rel="external">onDestroy()</a>)）</li>
<li>托管正执行其 <a href="https://developer.android.com/reference/android/content/BroadcastReceiver.html#onReceive(android.content.Context, android.content.Intent" target="_blank" rel="external">onReceive()</a>) 方法的 <a href="https://developer.android.com/reference/android/content/BroadcastReceiver.html" target="_blank" rel="external">BroadcastReceiver</a></li>
</ul>
</blockquote>
<p>通常，在任意给定时间前台进程都为数不多。只有在内在不足以支持它们同时继续运行这一万不得已的情况下，系统才会终止它们。 此时，设备往往已达到内存分页状态，因此需要终止一些前台进程来确保用户界面正常响应。</p>
<p>  <strong>2.可见进程</strong><br>      没有任何前台组件、但仍会影响用户在屏幕上所见内容的进程。 如果一个进程满足以下任一条件，即视为可见进程：</p>
<blockquote>
<ul>
<li>托管不在前台、但仍对用户可见的 <a href="https://developer.android.com/reference/android/app/Activity.html" target="_blank" rel="external">Activity</a>（已调用其 <a href="https://developer.android.com/reference/android/app/Activity.html#onPause(" target="_blank" rel="external">onPause()</a>) 方法）。例如，如果前台 <strong>Activity</strong> 启动了一个对话框，允许在其后显示上一 <strong>Activity</strong>，则有可能会发生这种情况</li>
<li>托管绑定到可见（或前台）<strong>Activity</strong> 的 <a href="https://developer.android.com/reference/android/app/Service.html" target="_blank" rel="external">Service</a></li>
</ul>
</blockquote>
<p>可见进程被视为是极其重要的进程，除非为了维持所有前台进程同时运行而必须终止，否则系统不会终止这些进程。</p>
<p>  <strong>3.服务进程</strong><br>      正在运行已使用 <a href="https://developer.android.com/reference/android/content/Context.html#startService(android.content.Intent" target="_blank" rel="external">startService()</a>) 方法启动的服务且不属于上述两个更高类别进程的进程。尽管服务进程与用户所见内容没有直接关联，但是它们通常在执行一些用户关心的操作（例如，在后台播放音乐或从网络下载数据）。因此，除非内存不足以维持所有前台进程和可见进程同时运行，否则系统会让服务进程保持运行状态。</p>
<p>  <strong>4.后台进程</strong><br>      包含目前对用户不可见的 <strong>Activity</strong> 的进程（已调用 Activity 的 <a href="https://developer.android.com/reference/android/app/Activity.html#onStop(" target="_blank" rel="external">onStop()</a>) 方法）。这些进程对用户体验没有直接影响，系统可能随时终止它们，以回收内存供前台进程、可见进程或服务进程使用。 通常会有很多后台进程在运行，因此它们会保存在 LRU （最近最少使用）列表中，以确保包含用户最近查看的 <strong>Activity</strong> 的进程最后一个被终止。如果某个 Activity 正确实现了生命周期方法，并保存了其当前状态，则终止其进程不会对用户体验产生明显影响，因为当用户导航回该 <strong>Activity</strong> 时，<strong>Activity</strong> 会恢复其所有可见状态。 有关保存和恢复状态的信息，请参阅<a href="https://developer.android.com/guide/components/activities.html#SavingActivityState" target="_blank" rel="external">Activity</a>文档。</p>
<p>  <strong>5.空进程</strong><br>      不含任何活动应用组件的进程。保留这种进程的的唯一目的是用作缓存，以缩短下次在其中运行组件所需的启动时间。 为使总体系统资源在进程缓存和底层内核缓存之间保持平衡，系统往往会终止这些进程。</p>
<p>根据进程中当前活动组件的重要程度，<strong>Android</strong>会将进程评定为它可能达到的最高级别。例如，如果某进程托管着服务和可见<strong>Activity</strong>，则会将此进程评定为可见进程，而不是服务进程。</p>
<p>此外，一个进程的级别可能会因其他进程对它的依赖而有所提高，即服务于另一进程的进程其级别永远不会低于其所服务的进程。 例如，如果进程 <strong>A</strong> 中的内容提供程序为进程 <strong>B</strong> 中的客户端提供服务，或者如果进程 <strong>A</strong> 中的服务绑定到进程 <strong>B</strong> 中的组件，则进程 <strong>A</strong> 始终被视为至少与进程 <strong>B</strong> 同样重要。</p>
<p>由于运行服务的进程其级别高于托管后台 <strong>Activity</strong> 的进程，因此启动长时间运行操作的 <strong>Activity</strong> 最好为该操作启动服务，而不是简单地创建工作线程，当操作有可能比 <strong>Activity</strong> 更加持久时尤要如此。例如，正在将图片上传到网站的 <strong>Activity</strong> 应该启动服务来执行上传，这样一来，即使用户退出 <strong>Activity</strong>，仍可在后台继续执行上传操作。使用服务可以保证，无论 <strong>Activity</strong> 发生什么情况，该操作至少具备“服务进程”优先级。 同理，广播接收器也应使用服务，而不是简单地将耗时冗长的操作放入线程中。</p>
<h2 id="线程-（Thread）"><a href="#线程-（Thread）" class="headerlink" title="线程 （Thread）"></a>线程 （Thread）</h2><p>   应用启动时，系统会为应用创建一个名为“主线程”的执行线程。 此线程非常重要，因为它负责将事件分派给相应的用户界面小工具，其中包括绘图事件。 此外，它也是应用与 <strong>Android UI</strong> 工具包组件（来自 <a href="https://developer.android.com/reference/android/widget/package-summary.html" target="_blank" rel="external">android.widget</a> 和 <a href="https://developer.android.com/reference/android/view/package-summary.html" target="_blank" rel="external">android.view</a> 软件包的组件）进行交互的线程。因此，主线程有时也称为 <strong>UI</strong> 线程。</p>
<p>   系统绝对不会为每个组件实例创建单独的线程。运行于同一进程的所有组件均在 <strong>UI</strong>线程中实例化，并且对每个组件的系统调用均由该线程进行分派。因此，响应系统回调的方法（例如，报告用户操作的 <a href="https://developer.android.com/reference/android/view/View.html#onKeyDown(int, android.view.KeyEvent" target="_blank" rel="external">onKeyDown()</a>) 或生命周期回调方法）始终在进程的 <strong>UI</strong> 线程中运行。</p>
<p>   例如，当用户触摸屏幕上的按钮时，应用的 <strong>UI</strong> 线程会将触摸事件分派给小工具，而小工具反过来又设置其按下状态，并将无效请求发布到事件队列中。<strong>UI</strong> 线程从队列中取消该请求并通知小工具应该重绘自身。</p>
<p>   在应用执行繁重的任务以响应用户交互时，除非正确实施应用，否则这种单线程模式可能会导致性能低下。 特别地，如果 <strong>UI</strong> 线程需要处理所有任务，则执行耗时很长的操作（例如，网络访问或数据库查询）将会阻塞整个 <strong>UI</strong>。一旦线程被阻塞，将无法分派任何事件，包括绘图事件。从用户的角度来看，应用显示为挂起。 更糟糕的是，如果 UI 线程被阻塞超过几秒钟时间（目前大约是 <strong>5</strong> 秒钟），用户就会看到一个让人厌烦的“<a href="http://developer.android.com/guide/practices/responsiveness.html" target="_blank" rel="external">应用无响应</a>”<strong>(ANR)</strong> 对话框。如果引起用户不满，他们可能就会决定退出并卸载此应用。</p>
<p>   此外，<strong>Android UI</strong> 工具包并非线程安全工具包。因此，您不得通过工作线程操纵 <strong>UI</strong>，而只能通过 <strong>UI</strong> 线程操纵用户界面。因此，<strong>Android</strong> 的单线程模式必须遵守两条规则：<br>   <strong>1.</strong> 不要阻塞 <strong>UI</strong> 线程<br>   <strong>2.</strong> 不要在 <strong>UI</strong> 线程之外访问 <strong>Android UI</strong> 工具包</p>
<h3 id="工作线程-（Worker-Thread）"><a href="#工作线程-（Worker-Thread）" class="headerlink" title="工作线程 （Worker Thread）"></a>工作线程 （Worker Thread）</h3><p>根据上述单线程模式，要保证应用 UI 的响应能力，关键是不能阻塞 UI 线程。如果执行的操作不能很快完成，则应确保它们在单独的线程（“后台”或“工作”线程）中运行。</p>
<p>例如，以下代码演示了一个点击侦听器从单独的线程下载图像并将其显示在 <a href="https://developer.android.com/reference/android/widget/ImageView.html" target="_blank" rel="external">ImageView</a> 中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void onClick(View v) &#123;</div><div class="line"></div><div class="line">     new Thread(new <span class="function"><span class="title">Runnable</span></span>() &#123;</div><div class="line"></div><div class="line">        public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line"></div><div class="line">           Bitmap b = loadImageFromNetwork(<span class="string">"http://example.com/image.png"</span>);</div><div class="line"></div><div class="line">           mImageView.setImageBitmap(b);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>乍看起来，这段代码似乎运行良好，因为它创建了一个新线程来处理网络操作。 但是，它违反了单线程模式的第二条规则：不要在 <strong>UI</strong> 线程之外访问 <strong>Android UI</strong> 工具包—此示例从工作线程（而不是 <strong>UI</strong> 线程）修改了 <a href="https://developer.android.com/reference/android/widget/ImageView.html" target="_blank" rel="external">ImageView</a>。这可能导致出现不明确、不可预见的行为，但要跟踪此行为困难而又费时。</p>
<p>为解决此问题，<strong>Android</strong> 提供了几种途径来从其他线程访问 <strong>UI</strong> 线程。以下列出了几种有用的方法：</p>
<blockquote>
<ul>
<li><a href="https://developer.android.com/reference/android/app/Activity.html#runOnUiThread(java.lang.Runnable" target="_blank" rel="external">Activity.runOnUiThread(Runnable)</a>)</li>
<li><a href="https://developer.android.com/reference/android/view/View.html#post(java.lang.Runnable" target="_blank" rel="external">View.post(Runnable)</a>)</li>
<li><a href="https://developer.android.com/reference/android/view/View.html#postDelayed(java.lang.Runnable, long" target="_blank" rel="external">View.postDelayed(Runnable, long)</a>)<br>例如，您可以通过使用 <a href="https://developer.android.com/reference/android/view/View.html#post(java.lang.Runnable" target="_blank" rel="external">View.post(Runnable)</a>) 方法修复上述代码：</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public void onClick(View v) &#123;</div><div class="line"></div><div class="line">       new Thread(new <span class="function"><span class="title">Runnable</span></span>() &#123;</div><div class="line"></div><div class="line">          public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line"></div><div class="line">              final Bitmap bitmap = loadImageFromNetwork(<span class="string">"http://example.com/image.png"</span>);</div><div class="line"></div><div class="line">              mImageView.post(new <span class="function"><span class="title">Runnable</span></span>() &#123;</div><div class="line"></div><div class="line">                  public void <span class="function"><span class="title">run</span></span>() &#123;</div><div class="line"></div><div class="line">                      mImageView.setImageBitmap(bitmap);</div><div class="line"></div><div class="line">                  &#125; </div><div class="line"></div><div class="line">              &#125;);</div><div class="line"></div><div class="line">          &#125;</div><div class="line"></div><div class="line">      &#125;).start();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在，上述实现属于线程安全型：在单独的线程中完成网络操作，而在 <strong>UI</strong> 线程中操纵 <a href="https://developer.android.com/reference/android/widget/ImageView.html" target="_blank" rel="external">ImageView</a>。</p>
<p>但是，随着操作日趋复杂，这类代码也会变得复杂且难以维护。 要通过工作线程处理更复杂的交互，可以考虑在工作线程中使用 <a href="https://developer.android.com/reference/android/os/Handler.html" target="_blank" rel="external">Handler</a> 处理来自 <strong>UI</strong> 线程的消息。当然，最好的解决方案或许是扩展 <a href="https://developer.android.com/reference/android/os/AsyncTask.html" target="_blank" rel="external">AsyncTask</a><br>类，此类简化了与 UI 进行交互所需执行的工作线程任务。</p>
<p>使用 <strong>AsyncTask</strong></p>
<p><a href="https://developer.android.com/reference/android/os/AsyncTask.html" target="_blank" rel="external">AsyncTask</a> 允许对用户界面执行异步操作。它会先阻塞工作线程中的操作，然后在 UI 线程中发布结果，而无需您亲自处理线程和/或处理程序。</p>
<p>要使用它，必须创建 <a href="https://developer.android.com/reference/android/os/AsyncTask.html" target="_blank" rel="external">AsyncTask</a> 子类并实现 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#doInBackground(Params..." target="_blank" rel="external">doInBackground()</a>) 回调方法，该方法将在后台线程池中运行。要更新 <strong>UI</strong>，必须实现 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#onPostExecute(Result" target="_blank" rel="external">onPostExecute()</a>) 以传递 doInBackground() 返回的结果并在 UI 线程中运行，这样，您即可安全更新 UI。稍后，您可以通过从 <strong>UI</strong> 线程调用 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#execute(Params..." target="_blank" rel="external">execute()</a>) 来运行任务。</p>
<p>例如，您可以通过以下方式使用 <a href="https://developer.android.com/reference/android/os/AsyncTask.html" target="_blank" rel="external">AsyncTask</a> 来实现上述示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public void onClick(View v) &#123;</div><div class="line">    </div><div class="line">    new DownloadImageTask().execute(<span class="string">"http://example.com/image.png"</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">private class DownloadImageTask extends AsyncTask&lt;String, Void, Bitmap&gt; &#123;</div><div class="line"></div><div class="line">    /** The system calls this to perform work <span class="keyword">in</span> a worker thread and</div><div class="line"></div><div class="line">      * delivers it the parameters given to AsyncTask.execute() */</div><div class="line"></div><div class="line">      protected Bitmap <span class="keyword">do</span>InBackground(String... urls) &#123;</div><div class="line"></div><div class="line">          <span class="built_in">return</span> loadImageFromNetwork(urls[0]);</div><div class="line">      &#125;</div><div class="line">    </div><div class="line">   /** The system calls this to perform work <span class="keyword">in</span> the UI thread and delivers</div><div class="line"> </div><div class="line">     * the result from <span class="keyword">do</span>InBackground() */</div><div class="line"></div><div class="line">     protected void onPostExecute(Bitmap result) &#123;</div><div class="line"></div><div class="line">       mImageView.setImageBitmap(result);</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在 <strong>UI</strong> 是安全的，代码也得到简化，因为任务分解成了两部分：一部分应在工作线程内完成，另一部分应在 <strong>UI</strong> 线程内完成。</p>
<p>下面简要概述了 <strong>AsyncTask</strong> 的工作方法，但要全面了解如何使用此类，您应阅读 <a href="https://developer.android.com/reference/android/os/AsyncTask.html" target="_blank" rel="external">AsyncTask</a> 参考文档：</p>
<blockquote>
<ul>
<li>可以使用泛型指定参数类型、进度值和任务最终值</li>
<li>方法 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#doInBackground(Params..." target="_blank" rel="external">doInBackground()</a>) 会在工作线程上自动执行</li>
<li><a href="https://developer.android.com/reference/android/os/AsyncTask.html#onPreExecute(" target="_blank" rel="external">onPreExecute()</a>)、<a href="https://developer.android.com/reference/android/os/AsyncTask.html#onPostExecute(Result" target="_blank" rel="external">onPostExecute()</a>) 和 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#onProgressUpdate(Progress..." target="_blank" rel="external">onProgressUpdate()</a>) 均在 UI 线程中调用</li>
<li><a href="https://developer.android.com/reference/android/os/AsyncTask.html#doInBackground(Params..." target="_blank" rel="external">doInBackground()</a>)返回的值将发送到 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#onPostExecute(Result" target="_blank" rel="external">onPostExecute()</a>)</li>
<li>您可以随时在 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#doInBackground(Params..." target="_blank" rel="external">doInBackground()</a>) 中调用<a href="https://developer.android.com/reference/android/os/AsyncTask.html#publishProgress(Progress..." target="_blank" rel="external">publishProgress()</a>)，以在 UI 线程中执行 <a href="https://developer.android.com/reference/android/os/AsyncTask.html#onProgressUpdate(Progress..." target="_blank" rel="external">onProgressUpdate()</a>)</li>
<li>您可以随时取消任何线程中的任务</li>
</ul>
</blockquote>
<p><strong>注意</strong>：使用工作线程时可能会遇到另一个问题，即：<a href="https://developer.android.com/guide/topics/resources/runtime-changes.html" target="_blank" rel="external">运行时配置变更</a>（例如，用户更改了屏幕方向）导致 <strong>Activity</strong> 意外重启，这可能会销毁工作线程。 要了解如何在这种重启情况下坚持执行任务，以及如何在 <strong>Activity</strong> 被销毁时正确地取消任务，请参阅<a href="http://code.google.com/p/shelves/" target="_blank" rel="external">书架</a>示例应用的源代码。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shoewann0402.github.io/2016/05/15/Android中的进程与线程/" data-id="civ2c4zls000t6wpb2cntwdhx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Process/">Process</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Thread/">Thread</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/线程/">线程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/进程/">进程</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/05/16/Google官方Android开源库-FlexboxLayout/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Google官方Android开源库--FlexboxLayout
        
      </div>
    </a>
  
  
    <a href="/2016/05/13/利用Dex-In-Process-使Android-Studio-编译更快/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">利用Dex In Process 使Android Studio 编译更快</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-Developer/">Android Developer</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-Developer/Security/">Security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-Developer/Vector-Drawable/">Vector Drawable</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Firebase/">Firebase</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Firebase/Google-cloud/">Google cloud</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Java/网络通信/">网络通信</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Material-Design/">Material Design</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Wifi/">Wifi</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-N/">Android N</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-N/Notiification/">Notiification</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-N/加密解密/">加密解密</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Studio/">Android Studio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Wear/">Android Wear</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-性能优化/">Android 性能优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-自定义/">Android 自定义</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dart/">Dart</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Dart/Flutter/">Flutter</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google-IO/">Google IO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Android/">Android</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/">Activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-7-0/">Android 7.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-7-1/">Android 7.1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Customview/">Android Customview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-N/">Android N</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Performance/">Android Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio/">Android Studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio-Tips/">Android Studio Tips</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Support-Library/">Android Support Library</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-UI-Test/">Android UI Test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Wear/">Android Wear</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-性能优化/">Android 性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-自定义/">Android 自定义</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/App-Shortcuts/">App Shortcuts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apps/">Apps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bottom-Sheets/">Bottom Sheets</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Featured/">Featured</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Firebase/">Firebase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flat-Button/">Flat Button</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Floating-Action-Button/">Floating Action Button</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google-Cloud/">Google Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google-I-O/">Google I/O</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intent/">Intent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notification/">Notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nougat/">Nougat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Process/">Process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raised-Button/">Raised Button</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Security/">Security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Seekbar/">Seekbar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Snackbar/">Snackbar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/">TCP/IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thread/">Thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Traceview/">Traceview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vector-Drawable/">Vector Drawable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wifi/">Wifi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb-no-permissions/">adb no permissions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encrypt/">encrypt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flexbox-layout/">flexbox-layout</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-io/">google io</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io/">io</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/library/">library</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile-vision-APIs/">mobile vision APIs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nio/">nio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/notification/">notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stack/">stack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task/">task</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/任务/">任务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/加密解密/">加密解密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件读写/">文件读写</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/线程/">线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络安全/">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络通信/">网络通信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/返回栈/">返回栈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/进程/">进程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/通知/">通知</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Activity/" style="font-size: 10px;">Activity</a> <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Android-7-0/" style="font-size: 13.33px;">Android 7.0</a> <a href="/tags/Android-7-1/" style="font-size: 16.67px;">Android 7.1</a> <a href="/tags/Android-Customview/" style="font-size: 10px;">Android Customview</a> <a href="/tags/Android-N/" style="font-size: 13.33px;">Android N</a> <a href="/tags/Android-Performance/" style="font-size: 13.33px;">Android Performance</a> <a href="/tags/Android-Studio/" style="font-size: 13.33px;">Android Studio</a> <a href="/tags/Android-Studio-Tips/" style="font-size: 13.33px;">Android Studio Tips</a> <a href="/tags/Android-Support-Library/" style="font-size: 10px;">Android Support Library</a> <a href="/tags/Android-UI-Test/" style="font-size: 10px;">Android UI Test</a> <a href="/tags/Android-Wear/" style="font-size: 10px;">Android Wear</a> <a href="/tags/Android-性能优化/" style="font-size: 13.33px;">Android 性能优化</a> <a href="/tags/Android-自定义/" style="font-size: 10px;">Android 自定义</a> <a href="/tags/App-Shortcuts/" style="font-size: 10px;">App Shortcuts</a> <a href="/tags/Apps/" style="font-size: 10px;">Apps</a> <a href="/tags/Bottom-Sheets/" style="font-size: 10px;">Bottom Sheets</a> <a href="/tags/Featured/" style="font-size: 10px;">Featured</a> <a href="/tags/Firebase/" style="font-size: 10px;">Firebase</a> <a href="/tags/Flat-Button/" style="font-size: 10px;">Flat Button</a> <a href="/tags/Floating-Action-Button/" style="font-size: 10px;">Floating Action Button</a> <a href="/tags/Flutter/" style="font-size: 13.33px;">Flutter</a> <a href="/tags/Google-Cloud/" style="font-size: 10px;">Google Cloud</a> <a href="/tags/Google-I-O/" style="font-size: 10px;">Google I/O</a> <a href="/tags/Intent/" style="font-size: 10px;">Intent</a> <a href="/tags/Notification/" style="font-size: 10px;">Notification</a> <a href="/tags/Nougat/" style="font-size: 13.33px;">Nougat</a> <a href="/tags/Process/" style="font-size: 10px;">Process</a> <a href="/tags/Raised-Button/" style="font-size: 10px;">Raised Button</a> <a href="/tags/Security/" style="font-size: 10px;">Security</a> <a href="/tags/Seekbar/" style="font-size: 10px;">Seekbar</a> <a href="/tags/Snackbar/" style="font-size: 10px;">Snackbar</a> <a href="/tags/TCP-IP/" style="font-size: 10px;">TCP/IP</a> <a href="/tags/Thread/" style="font-size: 10px;">Thread</a> <a href="/tags/Traceview/" style="font-size: 10px;">Traceview</a> <a href="/tags/Vector-Drawable/" style="font-size: 10px;">Vector Drawable</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Wifi/" style="font-size: 10px;">Wifi</a> <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/adb-no-permissions/" style="font-size: 10px;">adb no permissions</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/encrypt/" style="font-size: 10px;">encrypt</a> <a href="/tags/flexbox-layout/" style="font-size: 10px;">flexbox-layout</a> <a href="/tags/google-io/" style="font-size: 10px;">google io</a> <a href="/tags/io/" style="font-size: 10px;">io</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/library/" style="font-size: 10px;">library</a> <a href="/tags/mobile-vision-APIs/" style="font-size: 10px;">mobile vision APIs</a> <a href="/tags/nio/" style="font-size: 10px;">nio</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/task/" style="font-size: 10px;">task</a> <a href="/tags/任务/" style="font-size: 10px;">任务</a> <a href="/tags/加密解密/" style="font-size: 10px;">加密解密</a> <a href="/tags/文件读写/" style="font-size: 10px;">文件读写</a> <a href="/tags/线程/" style="font-size: 10px;">线程</a> <a href="/tags/网络安全/" style="font-size: 10px;">网络安全</a> <a href="/tags/网络通信/" style="font-size: 10px;">网络通信</a> <a href="/tags/返回栈/" style="font-size: 10px;">返回栈</a> <a href="/tags/进程/" style="font-size: 10px;">进程</a> <a href="/tags/通知/" style="font-size: 10px;">通知</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/03/AES-in-Android/">Android中的AES加密解密技术</a>
          </li>
        
          <li>
            <a href="/2016/11/03/support-ended-for-eclipse-android/">终止Android开发工具对与Eclipse的支持</a>
          </li>
        
          <li>
            <a href="/2016/10/21/android71-dev-preview-app-shortcuts/">Android 7.1 应用快捷键详解</a>
          </li>
        
          <li>
            <a href="/2016/10/20/android71-dev-preview-available/">现在可用：Android 7.1开发者预览版</a>
          </li>
        
          <li>
            <a href="/2016/10/12/android-71-developer-preview/">即将到来：Android 7.1 开发者预览版</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Shoewann<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>